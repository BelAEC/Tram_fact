<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script>
    <title>contact picker</title>
</head>
<body>
    <h1>contact picker</h1>
    <button id="select" onclick="displayContacts()">Selectionner Contacts</button>
    <div id="myDiv"></div>
   
    <script>
    
let yourContact = "";

async function pickContact(){
        
    if ("contacts" in navigator && 
        "select" in navigator.contacts && 
        "getProperties" in navigator.contacts) {
        
    try {
    
        const availableProperties = await navigator.contacts.getProperties();
        
            const contactProperties = ['name','address', 'tel', 'email'];
         
        
         if (availableProperties.includes("name")) {
              
                    const contacts = await navigator
                    .contacts
                    .select(
                    contactProperties,
                    {multiple: true}
                    );
         
            if(contacts[0].address.length > 0){
            
             
        yourContact = contacts[0].name +  "<br />" + " "  +" " +contacts[0].address[0].addressLine + "<br />"+contacts[0].address[0].city+ "<br />"+contacts[0].address[0].region + "<br />"+contacts[0].address[0].postalCode + contacts[0].tel + "<br />" +contacts[0].email;   
        
        }else{
             yourContact= contacts[0].name+"<br />"+contacts[0].tel+"<br />" + contacts[0].email;
        }
  
    }
    
    else {
        document.getElementbyId("problem").innerHTML  = "wer are in the name and email only section";
       
        document.getElementbyId("problem").innerHTML  = "Contact Picker API on your device doesn't support address or email property";
        }
    } catch(error) {
    document.getElementbyId("problem").innerHTML  = "Unexpected error happened in Contact Picker API";
    }

    } else {
    document.getElementbyId("problem").innerHTML  = "Your browser doesn't support Contact Picker API";
    }
}

async function displayContacts(){
   
    await pickContact();
    document.getElementById('myDiv').innerHTML = "</br>" + yourContact;
}
function printAndSend() {
      // Generate PDF from the webpage
      const element = document.documentElement;
      const options = {
        margin: [10, 10, 10, 10], // Top, right, bottom, left margins (in mm)
        filename: 'webpage.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
      };

      html2pdf().set(options).from(element).save().then(function () {
        selectContact();
      }).catch(function (error) {
        console.error('Error generating PDF:', error);
      });
    }

    function selectContact() {
      if ('contacts' in navigator) {
        navigator.contacts.select(['email']).then(function (contacts) {
          if (contacts.length > 0) {
            var selectedEmail = getEmailFromContact(contacts[0]);
            if (selectedEmail) {
              sendEmail(selectedEmail);
            } else {
              console.log('No email address found in the selected contact.');
            }
          } else {
            console.log('No contacts selected.');
          }
        }).catch(function (err) {
          console.error('Error selecting contact:', err);
        });
      } else {
        console.log('The contacts API is not supported.');
      }
    }

    function getEmailFromContact(contact) {

      if (contact.email && contact.email.length > 0 && contact.email[0].value) {
        return contact.email[0].value;
      } else {
        return null;
      }
    }

    function sendEmail(email) {
      var subject = 'facture';
      var body = '';
      var mailtoUrl = 'mailto:' + email + '?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);

      // Open the email client with the PDF attached
      window.location.href = mailtoUrl;
    }

}
</script>
</body>
</html>


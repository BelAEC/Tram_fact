<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <!-- Bootstrap CSS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <!-- Custom Style -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="styly.css">
       
    
    <!-- <script src="search.js" defer></script> -->
    <script src="https://apis.google.com/js/api.js"></script>
    
    

    <title>Invoice</title>
</head>

<body>

            
    <div class="my-5 page p-5" id="printArea" size="A4">
        <!-- <div class="p-5"> -->
            <section class="top-content bb d-flex justify-content-between">
                <div id="top-border" class="bb d-flex justify-content-between">
                    <div class="logo">
                                        
                        <img src="logo.jpg" alt="logo" style="height: 200px ; width:200px" img-fluid>
                    </div>
                    <div id="contact">
                    
                        <h3> <span>Acupuncture Yi King</span></h3><br><br>
                        <p style="font-size:1rem ; font-family: 'Segoe UI', Roboto"> <span><strong>Tram-Anh Dam, Ac</strong></span></p>
                        <p> <span> #Permis OAQ: A-035-13</span></p><br>
                        <div style="font-size:1rem"> <span>8220 Des Trembles, Mirabel (Qc) J7N 1T7</span></p>
                        <p> <span>2598A St-Zotique, Montreal (Qc) H1Y 1C7</span></p></div><br><br>
                        <img src="square-phone-solid.svg" style="width:18px ; height:18px"> <span>514-816-0356</span>
                        
                        <p><img src="envelope-solid.svg" style="width:18px ; height:18px ; line-height:12px;">  <span><i>tramanhdam.ac@gmail.com</i></span></p>
                        
                    </div>
                </div>    
                
                <div class="top-left" style="padding-right:25px">
                    <div class="graphic-path" >
                        
                    </div>
                    <div class="position-relative">
                        <p id="date"> <span>Date: </span></p>
                        <p id="facture"><span style="font-weight:600">Facture: </span>  </p>
                        <br><br><br>
                        <p> <span style="font-weight:600;margin-top:20px;padding:none">Dû à la réception</span></p>
                        <!-- <p><span>Solde dû : 0$</span></p> -->
                        <label for="solde">Solde dû : </label>
                        <input type="text" id="solde" style="width: 45px;" name="solde" value="0">
                    </div>
                </div>
            </section>
            <section id="commands">
                <div id="select-boxes">
                   
                <input type="button" class="noprint btn-danger nav-cancel" id="print" value="Imprimer" >
               
                <div id="searchboxes" style="display:flex; justify-content: space-between">
                  
                    <!-- <form id="form"> -->
                        <div class = "search-wrapper noprint">
                        <!-- <label for="search"> Search Contacts: type a name</label>
                        <input style="width: 65%" type="search" id="search" data-search> -->
                        <button id="select" onclick="displayContacts(this)">Selectionner Contacts</button>
                       
                        <!-- <button class="btn-form" onclick="resetForm(this);" id="refresh">Reset</button> -->
                        <button id ="send" onClick="printAndSend()";>Send Email</button>
                        
                        
                        </div>
                    <!-- </form> -->
            
                
                    <form id="search-Form">
                    <b></b>
                    
                    <!-- <button class="refresh" id="refresh-time">img</button> -->
                    <div id="treat1"></div> 
                    <!-- <label for="selJoueur" style="text-align: left; margin-top: 2%;">Faites votre choix</label> -->
                        <input type="number" class="noprint" id="qtyy" min="0" max="10" value="1" > 
                        <select class="noprint"  id="type"  name="treatment" onchange="selectTreatment(this);">
                                    <option selected="true" disabled="disabled" selected="selected">Selectionner Traitement</option>
                                    <option>Ouverture dossier </option>
                                    <option>Entrevue et traitement acupuncture Adulte  </option>
                                    <option>Entrevue et traitement acupuncture Moins de 18 ans  </option>
                                    <option>Acupuncture - Suivi Adulte</option>
                                    <option>Acupuncture - Suivi moins de 18 ans</option>
                                    <option>Acupuncture esthétique Aculift</option>
                                    <option>Acupuncture esthétique Aculift aiguilles en or</option>
                                    <option>Acupuncture esthetique Qi Beauty</option>
                                    <option>Acupuncture esthétique visage</option>
                                    <option>Acupuncture esthétique visage</option>
                                    <option>Acupuncture esthétique visage aiguilles en or </option>
                                
                            </select> 
                    
                    </form>
                  </div>
                </div>  
            </section>
            <div class="hide" id="myDiv"></div>
            <section class="store-user mt-5">
                <div class="col-10">
                    <h4>ADRESSE DE FACTURATION</h4>
                    
                    <div id="test" style="font-size:1.3rem ; line-height:normal;font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;" >
                     <!-- <a href = "mailto: example@mail.com">Send Email</a> -->
                    </div>
                   
                    <div id="problem"></div>
                    <textarea id="text-area" name="notes" rows="1" , cols="35"></textarea>
                       
                    <div class="no print row pb-3 ">
                    <div class="col-7">
                            
        <div class="user-cards noprint" id="user-cards" data-user-cards-container></div>
    
        <!-- take card and convert iinto template -->
        <!-- create html that doesnt show up on teht page -->
        
        <template  data-user-template >
           
            <!-- <div class="card" >
  
                        <div class="header" data-header>my Name</div>
                        <div class="address" data-address>address</div>
                        <div class="Ville" data-ville>Ville</div>
                        <div class="Region" data-region>Region</div>
                        <div class="CodePostal" data-codePostal>Code Postal</div>
                        <div class="tel" data-tel>Telephone</div>
                        <div class="body" data-body>email@gmail.com</div>
                       
                        <button id="btn-card" style="height:fit-content;width:fit-content"; data-button onclick= "getContacts(this);"><img src="0-circle.svg" alt="copy"></button>
             </div> -->
        
         </template>
    
                     </div>
                        <div class="col-5">
                            
                            
                        </div>
                    </div>
                    <div class="row extra-info pt-3">
                        <div class="col-7">
                            
                        </div>
                        <div class="col-5">
                          
                            <!-- <p>Deliver Date: <span>10-04.2021</span></p> -->
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="product-area mt-4">
                <table class="table table-hover bb">
                    <thead>
                        <!-- THIS THE HEADER TOP ROW IN MAROON -->
                        <tr id="treatment-type">
                            
                            <td class="treats">TYPE DE TRAITEMENT</td> 
                            <td class="treats">Prix unitaire</td>
                            <td class="treats" id="qty-item">Quantité</td>
                            <td>Total</td>
                        </tr>
                   
                   <!-- //THIS THE INJECTION TREATMENET ZONE -->
                    </thead>
                   
                    <tbody id="treatment-zone">
                        
                   <!-- //nothing here -->

                    </tbody>
                    
                </table>
            </section>

            <section class="balance-info">
                <div class="row">
                   
                    <div class="col-6" > <br><br>
                        <p style="margin-left:8px"class="m-0 font-weight-bold"> Notes : </p>
                       
                        <textarea id="text-area1" name = "notes" rows = '6', cols = '40'></textarea>
                        <div id="sante">Faites de votre santé une priorité!</div>
                        
                    </div>
                    <div class="col-6">
                          <table style="margin-left:115px" class="table border-0 table-hover" >
                            <tr>
                                <td id="sous-total">TOTAL: </td>
                                <td id="ss-total"></td>
                            </tr>
                            <tr>
                                <!-- <td>Tax:</td>
                                <td>15$</td> -->
                            </tr>
                            <tr>
                                <!-- <td>Deliver:</td>
                                <td>10$</td> -->
                            </tr>
                            <tfoot><br>
                                <tr>
                                    <td><button  id="calc-total" class="btn-success" aria-placeholder="PAYE : ">PAYE : </button></td>
                                    <td id="total"></td>
                                </tr>
                            </tfoot>
                        </table>
                        <br><br>
                        <!-- Signature -->
                        <div class="col-12">
                            
                            
                            <p class="text-left m-0 total-style">  Signature: </p>
                            <br>
                            <img src="signture.PNG" class="img-fluid" alt="">
                        </div>
                        
                    </div>
                
            </section>

    </div>
</div>
<script type="text/javascript"  src="contactPicker.js" defer ></script>
<!-- <script type="text/javascript"  src="sendEmail.js" defer ></script> -->

<script>
    
let yourContact= "";
let emailAddress = "";

async function displayContacts(){
    await pickContact();
     document.getElementById('test').innerHTML = yourContact;
     
         //  document.getElementById('test1').innerHTML = "</br>" + yourContact;
    
} 
// async function displayEmail(){

//      await pickContact();
//      document.getElementById('problem').innerHTML = "emailAddress = " +emailAddress;
//  }
 
 

function sendEmail(){

    pickContact();
    
         //if(contact[0].address[0].email>0){
    // if(document.getElementById('test').innerHTML!==""){
        //let testemailAddress = "bel@mail.com";
        // let emailAddress = document.getElementById("test").textContent;
       // emailAddress = contact[0].address[0].email;
        //console.log(testemailAddress);
    
       //let sendEmail = document.getElementById("send");
                       
            window.location.href="mailto:" + emailAddress;
      
//      }else{

//        document.getElementById('problem').innerHTML = "Email address not found";
//    }
} 
let date = new Date();

//date = date.toLocaleDateString('en-US');//alert(date);

let dailyInvoicecount = 0;
let paraFacture = document.getElementById('facture');
let p = document.createElement('p');

p.setAttribute('id', 'factureId'); 
 paraFacture.append(p);//appends paragrreph with id facture-id to p facture tag
 //let dinvoice="";
//  let textnode=document.createTextNode(dinvoice);  p.append(textnode);
  
  paraFacture.addEventListener('click', generate);//this generates invoice numbers
  
  //dinvoice = increment(); //alert("increment= "+increment());alert("dinvoice = "+dinvoice);
   
   
//must increment only the daily invoice count
    function increment(){
    dailyInvoicecount+=1; 
    dailyInvoicCount = dailyInvoicecount.toString();
    return dailyInvoicecount;
    }
    function generateInvoiceNumber(dailyInvoiceCount){
       
       let dd = date.getDate().toString(); 
       let mm = ((date.getMonth())+1).toString(); 
       let yy = date.getFullYear().toString();
       //alert (dd+" "+mm+" "+yy);
       
       invoice = yy+mm+dd+0+dailyInvoiceCount;
       return invoice;
    }    
    function generate(){
      generateInvoiceNumber(dailyInvoicecount);
      increment(); 
      document.getElementById('facture').innerHTML = "Facture : " +invoice;
    }
   
document.getElementById('date').innerHTML+=date.toLocaleDateString('en-US');

     let arr=[];
     let qty = 1; 
     let newPr = 0;
     let newprice = 0; 
    let total = 0;
    let newprArr = [];
     
    function selectTreatment(item){ //param = treat1 or treat2 - . adult , efnant...type typ2 (option)
      
        //set the array to evaluate correctly - remove the items from it. 
      
      newprArr = [];
       let sum = 0;
       qty = document.getElementById('qtyy').value;
       let sousTotal=0;
      
      let prix = 0;
     
      
      let myTreatments = document.getElementById("type");//goest to treat1 or to
      let treatment = myTreatments.options[type.selectedIndex].value; //alert(treatment);ok
             
     let newTag ='<table class="table table-hover"> <thead><tbody id="treatment-zone">'; 
     let newTag1= '<tr class="treatment-item" onClick= "removeItem(this);"><td>'+treatment+'</td>' +
                      '<td id="price-1" class="newprice">'+getPrix(treatment)+'$</td>' +
                       '<td id="qty-chosen" class="newprice">'+qty+'</td>' +
                        //'<td><input type="number" id="qty-chosen" value=1 style="width:35px;"></td>' +
                       '<td id="pric-1" class="newprice" >'+getPrix(treatment)*qty+'$</td></tr>';
    
      let newTag2= '</tbody></thead></table>';
      
      document.getElementById("treatment-zone").innerHTML += (newTag+newTag1+newTag2); //alert(newTag1);
 
    
                function getSum(){
                
                sousTotal += getPrix(treatment) * qty;   
                   
                 arr.push(sousTotal);
                    //console.log("newpr in getsume = "+newPr)   0
                    for(i=0; i < arr.length;i++){
                    
                    sum += arr[i]; 
                    }
                    console.log("sum / arr[i] =" +sum) ///correct sum
                    //console.log(newPr + "==newpr in getsum"); //0
                    console.log("sum in get sum = " +sum);
                    console.log("new sum in getsum = "+sum) //prints the sum 
                    //document.getElementById('myDiv') = sum;
                    return sum;  
                        
                    }
                    //new rpice is declared in select treatment
                    
                    
                    function displaySum(sum){
                    
                    document.getElementById("qtyy").value = 1; 
                    document.getElementById('myDiv').innerHTML = sum; //number
                    document.getElementById('sous-total').innerHTML = "TOTAL : "+(sum)+"$";
                    document.getElementById('calc-total').innerHTML = "PAYE : "+ (sum)+"$";
                                      
                    
                    // let newprice=0;// getNewPrice();
                           
                            //sum is a number 
                           // alert(sum);// ok
                           //if(newprice===0){
                            //document.getElementById("myDiv").innerHTML=0;
                            //} 
                             
                            //alert(newprice + typeof(newprice)); //nothing there yet
                            //newprice = parseInt(newprice); 
                            //alert(typeof(newprice)) //NANA
                        
                            console.log(newPr +" newprice in displaysum "+typeof(newprice));
                            console.log("type of sum sum sum" +typeof(sum));
                            console.log("answer : ")
                            console.log(sum-newprice);
                            console.log("=========End of answer====================== ")
                           
                            total = sum-newprice;
                            console.log("total = "+(sum-newprice));
                            
                            // console.log("sum = " +sum+ typeof(sum) +"newpr= " + newPr);

                        } 
                
                        getSum(); //gives sum

                        displaySum(sum); //should disply new total
                        
                        resetSelectElement(type);
        
        } 
        
        
        function removeItem(item){   
            
            
            //console.log(item); // <tr class="treatment-item" onclick="removeItem(this);"><td>Entrevue et traitement acupuncture Adulte</td><td id="price-1" class="newprice">75$</td><td id="qty-chosen" class="newprice">1</td><td id="pric-1" class="newprice">75$</td></tr>
             
            console.log("hello");
              
              // console.log(this); //prints the tr tag with td's
            //    console.log("hello");
              let tds = item.children;              // console.log(tds); //prints tds html collection
              newPr = parseInt((tds.item(3).innerHTML).replace('$', ''));
              console.log("newPr in removeitem = "+newPr); //number
            //document.getElementById("total").innerHTML = total - newPr;
             newprArr.push(newPr); //alert(newprArr.length);
             arr.push(-newPr); //alert("arr= " +arr);
             sum = document.getElementById('myDiv').innerHTML;
             displaynewSum();
            //document.getElementById("myDiv").innerHTML = newPr; //ok 
            console.log("newpr in removed item = " +newPr+typeof(newPr));  //newPr is number
            
            
            function displaynewSum(){

                newprArr.forEach(el => {
                sum-=el;
               // console.log(sum+ "  sum in newdisplay")
              
             });
           // document.getElementById('myDiv').innerHTML = sum; 
            
             // alert(total + "==final total");console.log(total+ " total in final display");
            item.parentNode.removeChild(item);
            //console.log("finalsum= " +sum);
            document.getElementById('sous-total').innerHTML = "TOTAL : "+(sum)+"$";
            document.getElementById('calc-total').innerHTML = "PAYE : "+ (sum)+"$";
                 }      //console.log("finalsum= " +sum);
                 
              }
         
                
           
          
        
 
    let btn = document.getElementById('print');
    
    btn.addEventListener('click', print_Facture);
    
    function print_Facture(){

        // Remove the print button in css
        //empty section removed
    
      let section= document.getElementById('commands');
      //let removeContacts = document.getElementById('user-cards');
      section.remove();
      //removeContacts.remove();
     
      window.print();  
      
      
      //printWindow.close();
        
    }
    
    function resetSelectElement(element) {
    element.selectedIndex = 0;  // first option is selected, or
    qty=1;                               // -1 for no option selected
    }
    function getPrix(treatment){
        
                    
        if(treatment==="Entrevue et traitement acupuncture Adulte"||treatment === "Acupuncture - Suivi Adulte"){
            prix=75; 
            
        }
        else if(treatment==="Ouverture dossier"){
            prix=15;
           
        }
        else if(treatment==="Acupuncture esthétique Aculift"){
            prix=115;
            
        }
        
        else 
            if(treatment==="Entrevue et traitement acupuncture Moins de 18 ans" || treatment==="Acupuncture - Suivi moins de 18 ans"){
            prix=65;
            
        }
        else if(treatment==="Acupuncture esthétique Aculift aiguilles en or"){
            prix=135;
            
        }
        else if(treatment==="Acupuncture esthetique Qi Beauty"){
            
            prix=145;
            
        }
        else if(treatment==="Acupuncture esthétique visage"){
            prix=40;
            
        }else if(treatment ==="Acupuncture esthétique visage aiguilles en or"){
            prix = 60;
        }
        
        else{

            prix = 0;
            
        }
           
        return prix;
    }
    //======================NOT ACTIVE BELOW ======================
    
    function removeEl(treatment,sum){
    
    let treats = document.querySelectorAll('.treatment-item');

       for(let i = 0; i<treats.length;i++){
           
           treats[i].addEventListener('click', function (e){
           
           //below does not work because classes. prints 1st amount only
          //let newPr = document.querySelector('.treatment-item .newprice').innerHTML;
         
         // console.log(this); //prints the tr tag with td's
          let tds = this.children;
          newPr = parseInt((tds.item(3).innerHTML).replace('$',''));
          console.log("nwpr = " +newPr);
          console.log('sum - newpr = ' +(sum-newPr));
                           
          //total+=parseInt(newPr);
        
           //let newPr = document.querySelector('.treatment-item :nth-child(4)').innerHTML;
           //console.log(newPr);
           
           this.remove();
               
           //getPrix(treatment);
           
           //document.getElementById('calc-total').innerHTML = "You paid : "+ newPr+"$";
           
           e.preventDefault();
          
           console.log ("sum-newpr" + (sum - newPr));
           //return newPr;
          
       })
     } 
   }
</script>

</body>
</html>

